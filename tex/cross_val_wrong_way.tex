
\section{Cross Validation The Wrong and Right Way}

This is adapted from ESL 7.10.2. Suppose you are facing a regression problem with many candidate predictor variables. Here is a \emph{bad} procedure:

\begin{enumerate}
   \item Screen the predictors. Find the predictor that is most correlated with the target. 
   \item Using just this predictor, build fit a polynomial curve to the data using linear regression. 
   \item Use cross-validation to find the best polynomial order. 
\end{enumerate}

Let's see how this works using American Time Use Survey data. First, we use only the 2024 data. 

\begin{lstlisting}
import pandas as pd
import numpy as np

df = pd.read_csv("atussum_2024.dat")

# TRERNWA is a weekly earnings variable
df = df[df['TRERNWA'] > 0]
income = df['TRERNWA']

# time use columns happen to start with lower-case t
time_use_columns = [c for c in df.columns if c.startswith("t")]
# there are 372 time use columns. a lot!

# find most correlated column
highest_correlation = 0
best_col = None
for col in time_use_columns:
    r = np.corrcoef(income, df[col])[0][1]
    
    if np.abs(r) > np.abs(highest_correlation):
        best_col = col
        highest_correlation = r

# t030405, waiting associated with caring for household adults is the most correlated    
\end{lstlisting}


