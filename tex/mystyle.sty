% ======= Core Packages (Load First) =======
\usepackage[utf8]{inputenc} % Unicode input support
\usepackage[T1]{fontenc} % Font encoding
\usepackage{graphicx} % Images
\usepackage{xcolor} % Colors

% ======= Math and Text Packages =======
\usepackage{amsmath} % Math environments
\usepackage{amssymb} % Math symbols
\usepackage{amsthm} % Theorem environments
\usepackage{csquotes} % Display quotes

% ======= Layout and Formatting =======
\usepackage[marginparsep=0.4mm]{geometry} % Page margins
\usepackage{booktabs} % Professional tables
\usepackage{adjustbox} % Image sizing
\usepackage{comment} % Block comments

% ======= Typography and Visual =======
\usepackage{fontawesome} % Icons
\usepackage{newunicodechar} % Unicode support
\newunicodechar{‚úè}{\faEdit} % Pencil - using FontAwesome
\newunicodechar{üìö}{\faBook} % Books - using FontAwesome
\newunicodechar{üí°}{\faLightbulbO} % Lightbulb - using FontAwesome
\newunicodechar{üìñ}{\faBook} % Dictionary - using FontAwesome
\newunicodechar{‚úì}{\checkmark}
\newunicodechar{‚úó}{\times}
\newunicodechar{√ó}{\times}
% ======= Additional Packages =======
\usepackage{makeidx} % Index generation
\usepackage{caption} % Caption formatting
\usepackage{colortbl} % Colored tables
\usepackage{float} % Float positioning
\usepackage{fancyhdr} % Headers and footers
\usepackage{titlesec} % Section formatting
\usepackage{setspace} % Line spacing
\usepackage{cleveref} % Smart cross-referencing - must be loaded after amsmath


% ======= Color Definitions =======
\definecolor{cellbackground}{RGB}{248,248,248}
\definecolor{cellborder}{RGB}{200,200,200}

% Exercise box colors
\definecolor{exerciseblue}{RGB}{230,240,250}
\definecolor{exerciseblue-border}{RGB}{70,130,200}
\definecolor{readinggreen}{RGB}{235,245,235}
\definecolor{readinggreen-border}{RGB}{60,140,60}
\definecolor{definitionyellow}{RGB}{255,250,235}
\definecolor{definitionyellow-border}{RGB}{200,150,30}

% ======= TColorBox Setup =======
\usepackage[breakable,skins]{tcolorbox}
\tcbset{nobeforeafter} % prevents tcolorboxes being placing in paragraphs

% Custom tcolorbox environments
\newtcolorbox{exercisebox}[1][]{
  breakable,
  enhanced,
  colback=exerciseblue,
  colframe=exerciseblue-border,
  boxrule=1.2pt,
  arc=4pt,
  title={‚úèÔ∏è Exercise},
  fonttitle=\bfseries,
  coltitle=black,
  attach boxed title to top left={yshift=-2mm,xshift=3mm},
  boxed title style={arc=2pt,colback=exerciseblue-border,coltext=white},
  pad at break*=1mm,
  #1
}

\newtcolorbox{readingbox}[1][]{
  breakable,
  enhanced,
  colback=readinggreen,
  colframe=readinggreen-border,
  boxrule=1.2pt,
  arc=4pt,
  title={üìö Reading},
  fonttitle=\bfseries,
  coltitle=black,
  attach boxed title to top left={yshift=-2mm,xshift=3mm},
  boxed title style={arc=2pt,colback=readinggreen-border,coltext=white},
  pad at break*=1mm,
  #1
}

\newtcolorbox{definitionbox}[1][]{
  breakable,
  enhanced,
  colback=definitionyellow,
  colframe=definitionyellow-border,
  boxrule=1.2pt,
  arc=4pt,
  title={üìñ Definition},
  fonttitle=\bfseries,
  coltitle=black,
  attach boxed title to top left={yshift=-2mm,xshift=3mm},
  boxed title style={arc=2pt,colback=definitionyellow-border,coltext=white},
  pad at break*=1mm,
  #1
}

% ======= Theorem Environments (available but not used) =======
%\newtheorem{definition}{Definition}

% ======= Document Settings =======
% Prevent overflowing lines due to hard-to-break entities
\sloppy

% ======= Hyperref (Load Last) =======
\usepackage{hyperref} % Must be loaded after most other packages
\definecolor{citecolor}{rgb}{0,0.5,0}
\definecolor{linkcolor}{rgb}{0.2,0.2,0.7}
\hypersetup{
    breaklinks=true,
    colorlinks=true,
    urlcolor=blue,
    linkcolor=linkcolor,
    citecolor=citecolor,
    bookmarks=true,
    bookmarksnumbered=true,
    bookmarksopen=true,
    pdfstartview=FitH,
    pdfpagemode=UseOutlines,
    pdfpagelayout=OneColumn
    }
    
% Slightly bigger margins than the latex defaults, overwrites book-style left and right margins
\geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}

% Headers and footers setup
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0.4pt}
\fancyhead[L]{\small\leftmark}
% \fancyhead[R]{\small\rightmark} % Commented out to prevent overlap with long section titles
\fancyfoot[C]{\thepage}

% Section formatting
\titleformat{\section}
  {\Large\bfseries}
  {\thesection}
  {1em}
  {}
  [\titlerule]

\titleformat{\subsection}
  {\large\bfseries}
  {\thesubsection}
  {1em}
  {}

\titleformat{\subsubsection}
  {\normalsize\bfseries}
  {\thesubsubsection}
  {1em}
  {}

% Spacing around sections
\titlespacing*{\section}{0pt}{1.5em}{0.8em}
\titlespacing*{\subsection}{0pt}{1.2em}{0.6em}
\titlespacing*{\subsubsection}{0pt}{1em}{0.4em}

% Improved spacing
\setlength{\parskip}{0.6em}
\setlength{\parindent}{0pt}
\onehalfspacing  % 1.5 line spacing for better readability

% Code Listings

\definecolor{whitea}{rgb}{1,1,1}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}

\usepackage{listings} %%%%%%% manual add for more code formatting
\lstdefinestyle{mystyle}{
backgroundcolor=\color{backcolour},   
commentstyle=\color{codegreen},
keywordstyle=\color{magenta},
numberstyle=\tiny\color{codegray},
stringstyle=\color{codepurple},
basicstyle=\ttfamily\footnotesize,
breakatwhitespace=false,         
breaklines=true,                 
captionpos=b,                    
keepspaces=true,                 
numbers=left,                    
numbersep=5pt,                  
showspaces=false,                
showstringspaces=false,
showtabs=false,                  
tabsize=2,
escapeinside={(*@}{@*)},
language = Python
}
\lstset{style=mystyle}


% Creative Commons licensing - REMOVED
% \usepackage[
%     type={CC},
%     modifier={by-nc-sa},
%     version={4.0},
% ]{doclicense}

% Bibliography
\usepackage[
    backend=biber,
    style=apa,
    citestyle=authoryear
    ]{biblatex}
% \addbibresource{bib.bib} %Imports bibliography file - commented out to allow document-level control


% force notes to right
% instead of left right
\usepackage{etoolbox}
%\makeatletter
%\patchcmd{\@addmarginpar}{\ifodd\c@page}{\ifodd\c@page\@tempcnta\m@ne}{}{}
%\makeatother
%\reversemarginpar
% https://tex.stackexchange.com/questions/69595/marginnote-always-on-right-side-of-the-page
\makeatletter
\long\def\@mn@@@marginnote[#1]#2[#3]{%
  \begingroup
    \ifmmode\mn@strut\let\@tempa\mn@vadjust\else
      \if@inlabel\leavevmode\fi
      \ifhmode\mn@strut\let\@tempa\mn@vadjust\else\let\@tempa\mn@vlap\fi
    \fi
    \@tempa{%
      \vbox to\z@{%
        \vss
        \@mn@margintest
        \if@reversemargin\if@tempswa
            \@tempswafalse
          \else
            \@tempswatrue
        \fi\fi
          \rlap{%
            \ifx\@mn@currxpos\relax
              \kern\marginnoterightadjust
              \if@mn@verbose
                \PackageInfo{marginnote}{%
                  xpos not known,\MessageBreak
                  using \string\marginnoterightadjust}%
              \fi
            \else\ifx\@mn@currxpos\@empty
                \kern\marginnoterightadjust
                \if@mn@verbose
                  \PackageInfo{marginnote}{%
                    xpos not known,\MessageBreak
                    using \string\marginnoterightadjust}%
                \fi
              \else
                \if@mn@verbose
                  \PackageInfo{marginnote}{%
                    xpos seems to be \@mn@currxpos,\MessageBreak
                    \string\marginnoterightadjust
                    \space ignored}%
                \fi
                \begingroup
                  \setlength{\@tempdima}{\@mn@currxpos}%
                  \kern-\@tempdima
                  \if@twoside\ifodd\@mn@currpage\relax
                      \kern\oddsidemargin
                    \else
                      \kern\evensidemargin
                    \fi
                  \else
                    \kern\oddsidemargin
                  \fi
                  \kern 1in
                \endgroup
              \fi
            \fi
            \kern\marginnotetextwidth\kern\marginparsep
            \vbox to\z@{\kern\marginnotevadjust\kern #3
              \vbox to\z@{%
                \hsize\marginparwidth
                \linewidth\hsize
                \kern-\parskip
                \marginfont\raggedrightmarginnote\strut\hspace{\z@}%
                \ignorespaces#2\endgraf
                \vss}%
              \vss}%
          }%
      }%
    }%
  \endgroup
}
\makeatother
